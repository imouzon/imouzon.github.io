
<!--Standard Header-->


<!DOCTYPE html>
<meta charset="utf-8" xmlns="http://www.w3.org/1999/html">
<html>
<head>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-61442471-1', 'auto');
        ga('send', 'pageview');

    </script>
    <!--// Load up d3 scripts and other scripts-->
    <!--<script type="text/javascript" src="../../resources/d3/d3.min.js"></script>-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js"></script>
    <!--<script type="text/javascript" src="http://harrysurden.com/resources/d3/d3.min.js"></script>-->

    <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>-->


    <link rel="stylesheet" type="text/css" href="./Probability_Tree_D3.css">
</head>



<body>
<div class="topContainer">
    <div class="header1">
        <div class = "container1">
            <div class="title-container">
                Probability Tree Diagram Using <a href = "http://d3js.org/" target="_blank" style=" text-decoration: none">D3</a> and Javascript

            </div>

            <div class = "sub-heading">
                By <a href="http://www.harrysurden.com" target="_blank"> Professor Harry Surden </a>

                <span class="loadMultiple" onclick="buttonClicked1()";> </span>

            </div>
        </div>
    </div>
</div>
<div class="mainContainer">
    <div class="svgHolder">

    </div>
    <div class="infoToggle" onclick="toggleInfo()">[-]</div>
    <div class="infoContainer">
        <div class="infoBox"  >
        <div class="buttonBox2">
            <div class="title">
                <h3> Change Probabilities</h3>
            </div>
            <div class="outside">
                <div class="buttonBox">

                    <div class="input1">
                        <div class="label1">
                            P(A)
                        </div>
                        <div class="textInput">
                            <input type="text" size="4" id="probA" value="">
                        </div>
                            <div class="buttonInput">
                            <input type="submit" value="OK" class="button" id="probAButton">
                        </div>
                    </div>
                    <br>

                    <div class="input1">
                        <div class="label1">
                            P(B|A)
                        </div>
                        <div class="textInput">
                            <input type="text" size="4" id="probBGivenA" value="">
                        </div>
                        <div class="buttonInput">
                            <input type="submit" value="OK" class="button" id="probBGivenAButton">
                        </div>
                    </div>
             <br>

                    <div class="input1">
                        <div class="label1">
                            P(¬B|¬A)
                        </div>
                        <div class="textInput">
                            <input type="text" size="4" id="probNotBGivenNotA" value="">
                        </div>
                        <div class="buttonInput">
                            <input type="submit" value="OK" class="button" id="probNotBGivenNotAButton">
                        </div>
                    </div>

                    <div class = "input1">
                        <br>
                        <br>
                         Medical Interpretation
                        <input type="checkbox" name="medical" value="x" onchange="toggleMedical()">
                    </div>
                </div>
            </div>



        </div>

        <div class="tableTop">
            <!--<div class="table-title">-->
            <!--<h3>Data Table</h3>-->
            <!--</div>-->
            <table class="table-fill">
                <thead>
                <tr>
                    <th class="tableHead">P</th>
                    <th class="tableHead">A <br><span id="tableA"></span></th>
                    <th class="tableHead">¬ A <br><span id="tableNotA"></th>

                </tr>
                </thead>
                <tbody class="table-hover">
                <tr>
                    <td class="tableHead">  B <br><span id="tableB"></span></td>
                    <td  id="tableAB"></td>
                    <td class="text-left" id="tableNotAB"></td>
                </tr>
                <tr>
                    <td class="tableHead" >¬ B <br><span id="tableNotB"></span></td>
                    <td class="text-left"  id="tableANotB" ></td>
                    <td class="text-left"  id="tableNotANotB" ></td>
                    <!--<td class="greyRow"  id="tableNotB" ></td>-->

                </tr>
                </tbody>
            </table>

        </div>

        <div class="table2">
            <table >

                <tbody>
                <tr style="height:10px;">
                    <td class="td2"> P(A|B): </td>
                    <td> </td>
                    <td class="td2" style="height:10px"> <span id="tableAGivenB"></span></td>
                </tr>
                <tr>
                    <td class="td2" style=""> P(¬A|B): </td>
                    <td> </td>
                    <td class="td2" style="height:10px"> <span id="tableNotAGivenB"></span></td>
                </tr>
                </tbody>
            </table>

        </div>

        <div class="diseaseTable">

            <!--<table class="table3">-->
                <!--<thead>-->
                <!--<tr >-->
                    <!--<th class="tableHead"></th>-->
                    <!--<th class="tableHead"><span class="tdTitle">A</span> <br> Has Disease <div id="disease"></div></th>-->
                    <!--<th class="tableHead"><span class="tdTitle">¬A</span> <br> No Disease <div id="noDisease"></div></th>-->

                <!--</tr>-->
                <!--</thead>-->
                <!--<tbody class="table-hover">-->
                <!--<tr>-->
                    <!--<td class="tableHead"> <span class="tdTitle">B</span> <br> Tests Positive <div id="testPositive"></div></td>-->
                    <!--<td  id="tableAB1">True + <div id="truePositive"></div>-->
                    <!--<td class="text-left" id="tableNotAB1"> False + <div id="falsePositive"> </div></td>-->
                <!--</tr>-->
                <!--<tr>-->
                    <!--<td class="tableHead"><span class="tdTitle">¬B</span> <br> Tests Negative <div id="testNegative"></div></td>-->
                    <!--<td class="text-left"  id="tableANotB1" >False - <div id="falseNegative"> </div></td>-->
                    <!--<td class="text-left"  id="tableNotANotB1" >True -<div id="trueNegative"> </div></td>-->
                    <!--&lt;!&ndash;<td class="greyRow"  id="tableNotB" ></td>&ndash;&gt;-->

                <!--</tr>-->
                <!--</tbody>-->
            <!--</table>-->


            <div class="medical">
                <div class="table-title">
                <h3>Medical Interpretation</h3>
                </div>
                <table >

                    <tbody>
                    <tr style="height:10px;">
                        <td class="td2"> Percent of Population who Have  Disease: </td>
                        <td class="td2" style="height:10px"> <span id="disease"></span></td>
                    </tr>
                    <tr style="height:10px;">
                        <td class="td2"> Percent of Population who Do Not Have  Disease: </td>
                        <td class="td2" style="height:10px"> <span id="noDisease"></span></td>
                    </tr>
                    <tr style="height:10px;">
                        <td class="td2"> Test Sensitivity:<br> (True Positive Rate) </td>
                        <td class="td2" style="height:10px"> <span id="sensitivity"></span></td>
                    </tr>
                    <tr style="height:10px;">
                        <td class="td2">Test Specificity <br>(True Negative Rate): </td>
                        <td class="td2" style="height:10px"> <span id="specificity"></span></td>
                    </tr>
                    <tr style="height:10px; font-weight:800">
                        <td class="td2"> Probability of Having Disease Given Positive Test Result: </td>
                        <td class="td2" style="height:10px"> <span id="probDiseaseGivenPositive"></span></td>
                    </tr>
                    <!--<tr>-->
                        <!--<td class="td2" style=""> P(¬A|B): </td>-->
                        <!--<td> </td>-->
                        <!--<td class="td2" style="height:10px"> <span id="tableNotAGivenB"></span></td>-->
                    <!--</tr>-->
                    </tbody>
                </table>

            </div>

        </div>

    </div>
    </div>
</div>



<script>

    var data = [
        {
            "name": "P",
            "num":"0",
            "display": "P",
            "parent": "null",
            "children": [
                {
                    "name": "A",
                    "num":"1",
                    "display": "A",
                    "probability":".1",
                    "children": [
                        {
                            "name": "A&B",
                            "num":"3",
                            "display": "B",
                            "givenName":"P(B|A)",
                            "given":".99"
                        },
                        {
                            "name": "A&¬B",
                            "num":"4",
                            "display": "¬ B",
                            "givenName":"P(¬ B|A)"
                        }
                    ]
                },
                {
                    "name": "¬ A",
                    "display": "¬ A",
                    "num":"2",
                    "children": [
                        {
                            "name": "¬A&B",
                            "display": "B",
                            "num":"5",
                            "givenName":"P(B|¬ A)"
                        },
                        {
                            "name": "¬A&¬B",
                            "display": "¬ B",
                            "num":"6",
                            "given":".9",
                            "givenName":"P(¬ B|¬ A)"
                        }

                    ]
                }

            ]
        }
    ];



    var grandChildSpacing = 0;

    var margin = {top: 00, right: 140, bottom: 0, left: 90},
            width = 800 - margin.right - margin.left,
            height = 700 - margin.top - margin.bottom + (grandChildSpacing*4);

    var i = 0;
    var radius=40;

    var tree = d3.layout.tree()
//            .size([height, width]);
            .nodeSize([80,100])
            .separation(function (a,b) {
                if (a.depth ==2){
                    return 1.4
                } else {
                    return 1
                }
            });

    var svg = d3.select(".svgHolder").append("svg")
            .attr("width", width + margin.right + margin.left)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("id","topg")
            .attr("class","topg")
//            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            .attr("transform", "translate(100,220)");

    root = data[0];


// Assign variables to different parts of data structure

    var a = root.children[0];
    var notA = root.children[1];

    var aANDb = a.children[0];
    var aANDnotB = a.children[1];

    var notAANDb = notA.children[0];
    var notAANDnotB = notA.children[1];

    var b, notB, aGivenB, notAGivenB=0;
    var medical=false;


    // Set up button listeners for click

    d3.select("#probAButton").on("click", function(){


        updateProbabilities();
        animateA();
    });

    d3.select("#probBGivenAButton").on("click", function(){

        updateProbabilities();
        animateB1();
    });

    d3.select("#probNotBGivenNotAButton").on("click", function(){

        updateProbabilities();
        animateB2();
    });

    // Assign the initial values for the inputBoxes based upon
    // The dataset

    d3.select("#probA").attr("value", a.probability);
    d3.select("#probBGivenA").attr("value", aANDb.given);
    d3.select("#probNotBGivenNotA").attr("value",notAANDnotB.given)


    updateProbabilities();

    updateAll();


    function updateProbabilities (){

        // Get the value from entry box 1
        var probValue = d3.select("#probA");

        var nvalue = probValue[0][0].value;

        if (nvalue>=1){
            nvalue = nvalue/100;
        }

        // Set the value of a probability to the value in the input box
        // tofixed sets it so only two decimal points are used
        a.probability=Number(nvalue).toFixed(3);

        // Not A is always 1 minus A
        notA.probability =  (1-a.probability).toFixed(3);

        // Get the value from entry box 2 and assign it to given
        var aANDbGivenValue = d3.select("#probBGivenA");


        nvalue = aANDbGivenValue[0][0].value;
        if (nvalue>=1){
            nvalue = nvalue/100;
        }

        aANDb.given = Number(nvalue).toFixed(4);
        aANDnotB.given = (1-aANDb.given).toFixed(4);

        aANDb.probability = (a.probability* aANDb.given).toFixed(4);

        aANDnotB.probability = (a.probability*aANDnotB.given).toFixed(4);

        var notBGivenNotA = d3.select("#probNotBGivenNotA")


        nvalue= notBGivenNotA[0][0].value;
        if (nvalue>=1){
            nvalue = nvalue/100;
        }
        notAANDnotB.given = Number(nvalue).toFixed(4);
        notAANDb.given= (1-notAANDnotB.given).toFixed(4);

        notAANDb.probability = (notA.probability * notAANDb.given).toFixed(4);
        notAANDnotB.probability = (notA.probability*notAANDnotB.given).toFixed(4);

        b = (Number(aANDb.probability) + Number(notAANDb.probability)).toFixed(3);
        notB =(Number(aANDnotB.probability) + Number(notAANDnotB.probability)).toFixed(3);;

        aGivenB = (Number(aANDb.probability)/b).toFixed(3);
        notAGivenB = (1-aGivenB).toFixed(3);

        updateAll();
        animateEnds();
    }

    function updateAll ()
    {
        update (root)
        updateTable();
    }

    function updateTable (){

        d3.selectAll("#tableAB, #truePositive").text(formatNumber(aANDb.probability));

        d3.selectAll("#tableNotAB, #falsePositive").text(formatNumber(notAANDb.probability));


        d3.selectAll("#tableANotB,#falseNegative").text(formatNumber(aANDnotB.probability));
        d3.selectAll("#tableNotANotB,#trueNegative").text(formatNumber(notAANDnotB.probability));

        d3.selectAll("#tableB,#testPositive").text("("+String((b*100).toFixed(1)).replace(/^0+/, '')+"%)");
        d3.selectAll("#tableNotB,#testNegative").text("("+String((notB*100).toFixed(1)).replace(/^0+/, '')+"%)");

        d3.selectAll("#tableA, #disease").text("("+String((a.probability*100).toFixed(1)).replace(/^0+/, '')+"%)");
        d3.selectAll("#tableNotA,#noDisease").text("("+String((notA.probability*100).toFixed(1)).replace(/^0+/, '')+"%)");

        d3.selectAll("#tableAGivenB,#probDiseaseGivenPositive").text(String((aGivenB*100).toFixed(2)).replace(/^0+/, '')+"%");
        d3.select("#tableNotAGivenB").text(String((notAGivenB*100).toFixed(2)).replace(/^0+/, '')+"%");

        d3.selectAll("#sensitivity").text(formatNumber(aANDb.given,3,true));
        d3.selectAll("#specificity").text(formatNumber(notAANDnotB.given,3,true));
    }

    function update(source) {

        // Compute the  tree layout.
        var nodes = tree.nodes(root).reverse(),
                links = tree.links(nodes);

//        Normalize for fixed-depth.
        nodes.forEach(function (d) {
            d.y = d.depth * 250;
        });


        // Declare the nodes
        var node = svg.selectAll("g.node")
                .data(nodes, function (d) {
                    if (d.id){
                        return d.id;
                    } else {
                        d.id= i++;
                        return d.id;
                    }
//                    return d.id || (d.id = ++i);
                });

        var grandChildCount=0;

//        // Declare and append the links
        // Links go first so they are in front of circles in display

        var topg = d3.select("#topg");

        var link = topg.selectAll(".link")
                .data(links, function(d) {
                    return d.target.id;
                });

        var linkEnter = link.enter().insert("line")
                .attr("class", "link")
                .attr("x1", function (d){
                    return d.source.y;
                })
                .attr("y1", function (d){
                    return d.source.x;
                })
                .attr("x2", function (d){
                    return d.target.y;
                })
                .attr("y2", function (d){
                    return d.target.x;
                });


        // Update

        node.selectAll(".subText")
                .text(function (d) {
                    if (d.probability) {
                        return d.probability
                    } else { return ""}
                })
//                .duration(400)
//                .attr("fill","red")
        ;

        node.selectAll(".subTextWhite")
                .text(function (d) {
                    if (d.probability) {
                        return d.probability
                    } else { return ""}
                })
//                .duration(400)
//                .attr("fill","red")
        ;


        //Update Givens

        d3.selectAll(".givenProb")
//                .transition()
//                .duration(1400)
//                .style("font-weight","800")
//                .attr("fill","blue")
                .text(function (d) {
                    if (d.given) {
                        return d.given;
                    } else {
                        return "";
                    }
                })
//                .transition()
//                .duration(1400)
//                .delay(1400)
//                .attr("fill","black")
//                .style("font-weight","200")
                ;


        // Enter the nodes.
        var nodeEnter = node.
                enter().append("g")
                .attr("class", "node")
                .attr("transform", function (d) {
                    var y = d.y;
                    var x = d.x ;

                    d.shiftX=x;
                    if (d.depth==2){
                        if (grandChildCount%2) {
                            x = x-grandChildSpacing;
                            d.shiftX = x;
                        } else
                        {
                            x=x+grandChildSpacing;
                            d.shiftX = x;
                        }
                        grandChildCount++;
                    }
                    d.dy = y;
                    d.dx=x;
                    return "translate(" +  y+ "," + x + ")";
                });



        nodeEnter.append("circle")
                .attr("r", radius);
//                .style("fill", "#fff");

        nodeEnter.append("text")
                .text(function (d) {
                    return d.display;
                })
                .attr("text-anchor","middle")
                .style("fill-opacity", 1);



        nodeEnter.append("text")
                .text(function (d) {
                    if (d.probability) {
                        return d.probability

                    } else { return ""}
                })
                .attr("y","20")
                .attr("text-anchor","middle")
                .attr("class","subText")
                .attr("class", function (d){
                    if (d.depth==2){
                        return "subText"
                    } else{return "subTextWhite"}
                })
                .attr("x", function (d){
                  if (d.depth==2){
                      return 75;
                  }  else {return 0}

                });


        nodeEnter.append("text")
                .text(function (d) {
                    var text="";
                    if (d.depth ==2) {
                        var set1 = d.parent.display;
                        var set2 = d.display;
                        text = "P(" +set1 + " & "+ set2 +")";
                    }
                    return text;
                })
                .attr("class", "label1")
                .attr("transform","translate(50)")
            ;

        var gGiven = nodeEnter.filter(function (d){
           if (d.depth!=0){
               return true;
           } else {
               return false;
           }
        })
            .append("g")

            .attr("transform","translate(-160)")

        gGiven.append("text")
                .attr("class","given")
            .text(function (d) {
                    if (d.givenName){
                        return d.givenName
                    } else {
                        return "";
                    }
                });


        // Label the Links;

        gGiven.append("text")
                .attr("class","givenProb")
                .text(function (d){
                    if (d.given){
                        return d.given;
                    }else{
                        return "";
                    }
                })
                .attr("y","20");




    }

    function animateA() {

        var circle =
                d3.selectAll("circle")
                        .filter(function (d) {
                            if (d.depth == 1) {
                                return true;
                            } else {
                                return false;
                            }
                        });
        circle.transition()
                .duration(400)
                .attr("r", radius + 20)
                .transition()
//                .delay(50)
                .duration(400)
                .attr("r", radius)


        var text1 =
                d3.selectAll(".subTextWhite")
                        .filter(function (d) {
                            if (d.depth == 1) {

                                return true;

                            } else {
                                return false;
                            }
                        });

        text1.transition()
                .duration(function (d){

                    return 400;
                })
                .style("font-size","20px")
                .transition()
                .duration(400)
                .style("font-size","13px");

//        text1.transition()
//                .duration(1200)
//                .style("fill","red");
    }

    function animateB1() {

        var text =
                d3.selectAll(".givenProb")
                        .filter(function (d) {
                            if ((d.num == 3)||
                                    (d.num==4)){
                                return true;
                            } else {
                                return false;
                            }
                        });

        text.transition()
                .duration(400)
//                .style("fill", "red")
                .style("font-size","20px")
                .transition()
                .duration(400)
                .style("font-size","13px");
//                .style("fill", "white");
    }

    function animateB2() {

        var text =
                d3.selectAll(".givenProb")
                        .filter(function (d) {
                            if ((d.num == 5) ||
                                    (d.num == 6)) {
                                return true;
                            } else {
                                return false;
                            }
                        });

        text.transition()
                .duration(400)
//                .style("fill", "red")
                .style("font-size", "20px")
                .transition()
                .duration(400)
                .style("font-size", "13px");
        //                .style("fill", "white");
    }

    function animateEnds() {

        var text =
                d3.selectAll(".subText")
                        .filter(function (d) {
                            if ((d.num >= 4) ||
                                    (d.num <= 6)) {
                                return true;
                            } else {
                                return false;
                            }
                        });

        text.transition()
                .delay(500)
                .duration(400)
//                .style("fill", "red")
                .style("font-size", "20px")
                .transition()
                .duration(400)
                .style("font-size", "13px");
        //                .style("fill", "white");
    }

    function formatNumber (number, digits, percent){

        var dig =  typeof digits !== 'undefined' ? digits : 3;
        var showPercent = typeof percent !== 'undefined' ? percent : false;
        var num= Number(number).toFixed(dig);

        if (showPercent){
            num = num*100;
        }

        var number = String(num);
        number.replace(/^0+/, '');

        if (showPercent){
            number = number + "%";
        }

        return number;
    }

    function toggleMedical(){
        if (medical){

            d3.select(".medical")
                    .transition()
                    .duration(600)
                    .style("opacity","0");

            medical = false;
        } else{
            d3.select(".medical")
                    .transition()
                    .duration(600)
                    .style("opacity","1");
            medical=true;
        }
    }
    function toggleInfo (){

        var opacity = d3.select(".infoContainer")
                .style("opacity");


        if (opacity==1){
            d3.select(".infoContainer")
                    .transition()
                    .duration(400)
                    .style("opacity","0");

        } else{
            d3.select(".infoContainer")
                    .transition()
                    .duration(400)
                    .style("opacity","1");

        }
    }


</script>





    </div>
</body>

</html>
